<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMC Smart Road Reporting - AI Powered</title>
    
    <!-- React and ReactDOM via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX support -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 40%, #24243e 100%);
            position: relative;
        }

        /* Animated Gradient Background */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 100, 200, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(138, 35, 135, 0.3) 0%, transparent 50%);
            animation: gradientShift 15s ease infinite;
            z-index: 0;
        }

        @keyframes gradientShift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(10%, 10%) rotate(120deg); }
            66% { transform: translate(-10%, 5%) rotate(240deg); }
        }

        #root {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Glassmorphism Card Styles */
        .glass-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 
                0 8px 32px 0 rgba(31, 38, 135, 0.37),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
        }

        /* 3D Tilt Container */
        .tilt-container {
            perspective: 1000px;
            transition: transform 0.1s ease-out;
        }

        /* Fade-in animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeInUp 0.8s ease-out forwards;
        }

        /* Header Styles */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            width: 100%;
            max-width: 650px;
            animation: fadeInUp 0.6s ease-out;
        }

        .header h1 {
            font-size: 42px;
            font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, #e0d9ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            letter-spacing: -1px;
            text-shadow: 0 2px 20px rgba(255, 255, 255, 0.3);
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 400;
            letter-spacing: 0.5px;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Main Card Styles */
        .main-card {
            border-radius: 24px;
            padding: 40px;
            width: 100%;
            max-width: 650px;
            margin-bottom: 30px;
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
            transition: transform 0.1s ease-out, box-shadow 0.3s ease;
        }

        .card-title {
            font-size: 28px;
            color: white;
            margin-bottom: 30px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title::before {
            content: 'üõ£Ô∏è';
            font-size: 32px;
        }

        /* Form Group */
        .form-group {
            margin-bottom: 28px;
        }

        .form-label {
            display: block;
            font-size: 15px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 12px;
            letter-spacing: 0.3px;
        }

        /* File Upload Button */
        .upload-wrapper {
            position: relative;
            width: 100%;
        }

        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 28px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        .upload-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .upload-btn:hover::before {
            left: 100%;
        }

        .upload-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
        }

        .upload-btn:active {
            transform: translateY(-1px);
        }

        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        /* Image Preview */
        .image-preview {
            margin-top: 20px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 0.5s ease-out;
        }

        .image-preview img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Location Display */
        .location-box {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 20px;
            color: white;
            line-height: 1.8;
        }

        .location-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-top: 12px;
        }

        .location-status.loading {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .location-status.success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .location-status.error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Textarea */
        .input-textarea {
            width: 100%;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            font-size: 15px;
            font-family: inherit;
            color: white;
            resize: vertical;
            min-height: 120px;
            transition: all 0.3s ease;
        }

        .input-textarea::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .input-textarea:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* AI Badge */
        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 22px;
            border-radius: 30px;
            font-size: 15px;
            font-weight: 600;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .ai-badge.pending {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .ai-badge.analyzing {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            animation: pulse 2s ease-in-out infinite;
        }

        .ai-badge.verified {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Submit Button */
        .submit-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 18px 36px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px rgba(56, 239, 125, 0.4);
            letter-spacing: 0.5px;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(56, 239, 125, 0.5);
        }

        .submit-btn:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .submit-btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 32px;
            }

            .main-card {
                padding: 28px;
            }

            .card-title {
                font-size: 24px;
            }
        }

        @media (max-width: 480px) {
            #root {
                padding: 15px;
            }

            .header h1 {
                font-size: 28px;
            }

            .main-card {
                padding: 24px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Constants for 3D tilt effect
        const MOUSE_TILT_SENSITIVITY = 20;
        const ORIENTATION_TILT_SENSITIVITY = 10;
        const MAX_TILT_ANGLE = 15;

        // ============================================
        // LIGHTNING.AI INTEGRATION STUB
        // ============================================
        async function analyzeImageWithAI(imageBlob) {
            // TODO: REPLACE THIS URL with your Lightning.ai API Endpoint
            // const LIGHTNING_AI_ENDPOINT = 'https://your-lightning-ai-endpoint.com/analyze';
            
            // Simulate API call for now
            console.log('Analyzing image with AI...', imageBlob);
            
            // Simulated API call - returns mock result after 2 seconds
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve({
                        detected: true,
                        type: 'Pothole',
                        confidence: 0.92,
                        severity: 'High',
                        recommendation: 'Immediate repair recommended'
                    });
                }, 2000);
            });

            // Real implementation would look like this:
            /*
            try {
                const formData = new FormData();
                formData.append('image', imageBlob);
                
                const response = await fetch(LIGHTNING_AI_ENDPOINT, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Authorization': 'Bearer YOUR_API_KEY'
                    }
                });
                
                if (!response.ok) {
                    throw new Error('AI analysis failed');
                }
                
                const result = await response.json();
                return result;
            } catch (error) {
                console.error('AI Analysis Error:', error);
                throw error;
            }
            */
        }

        // ============================================
        // HEADER COMPONENT
        // ============================================
        function Header() {
            return (
                <div className="header">
                    <h1>SMC Smart Road Reporting</h1>
                    <p>Solapur Municipal Corporation ‚Ä¢ AI-Powered Road Damage Detection</p>
                </div>
            );
        }

        // ============================================
        // LOCATION STATUS COMPONENT
        // ============================================
        function LocationStatus({ latitude, longitude, status, error }) {
            return (
                <div className="form-group">
                    <label className="form-label">üìç Location</label>
                    <div className="location-box">
                        {status === 'loading' && <div>Detecting your location...</div>}
                        {status === 'success' && (
                            <div>
                                <strong>Latitude:</strong> {latitude?.toFixed(6)}<br />
                                <strong>Longitude:</strong> {longitude?.toFixed(6)}
                            </div>
                        )}
                        {status === 'error' && <div>{error}</div>}
                        
                        <span className={`location-status ${status}`}>
                            {status === 'loading' && '‚è≥ Getting GPS...'}
                            {status === 'success' && '‚úì Location detected'}
                            {status === 'error' && '‚úó Location error'}
                        </span>
                    </div>
                </div>
            );
        }

        // ============================================
        // UPLOAD CARD COMPONENT
        // ============================================
        function UploadCard({ onImageSelect, previewUrl }) {
            const fileInputRef = useRef(null);
            const [fileName, setFileName] = useState('');

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    setFileName(file.name);
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        onImageSelect(e.target.result, file);
                    };
                    reader.readAsDataURL(file);
                }
            };

            return (
                <div className="form-group">
                    <label className="form-label">üì∏ Upload Photo of Damage</label>
                    <div className="upload-wrapper">
                        <button type="button" className="upload-btn">
                            <span>üì∑</span>
                            <span>{fileName || 'Take Photo or Choose from Gallery'}</span>
                        </button>
                        <input
                            ref={fileInputRef}
                            type="file"
                            className="file-input"
                            accept="image/*"
                            capture="environment"
                            onChange={handleFileChange}
                        />
                    </div>
                    
                    {previewUrl && (
                        <div className="image-preview">
                            <img src={previewUrl} alt="Preview" />
                        </div>
                    )}
                </div>
            );
        }

        // ============================================
        // MAIN APP COMPONENT
        // ============================================
        function App() {
            const [imagePreview, setImagePreview] = useState(null);
            const [imageFile, setImageFile] = useState(null);
            const [location, setLocation] = useState({
                latitude: null,
                longitude: null,
                status: 'loading',
                error: null
            });
            const [description, setDescription] = useState('');
            const [aiStatus, setAiStatus] = useState('pending');
            const [aiResult, setAiResult] = useState(null);
            const [tiltStyle, setTiltStyle] = useState({});
            const cardRef = useRef(null);

            // Get location on mount
            useEffect(() => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            setLocation({
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude,
                                status: 'success',
                                error: null
                            });
                        },
                        (error) => {
                            let errorMessage = 'Unable to detect location';
                            switch(error.code) {
                                case error.PERMISSION_DENIED:
                                    errorMessage = 'Location permission denied. Please enable location access.';
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    errorMessage = 'Location information unavailable.';
                                    break;
                                case error.TIMEOUT:
                                    errorMessage = 'Location request timed out.';
                                    break;
                            }
                            setLocation({
                                latitude: null,
                                longitude: null,
                                status: 'error',
                                error: errorMessage
                            });
                        }
                    );
                } else {
                    setLocation({
                        latitude: null,
                        longitude: null,
                        status: 'error',
                        error: 'Geolocation is not supported by this browser.'
                    });
                }
            }, []);

            // 3D Tilt Effect
            useEffect(() => {
                const card = cardRef.current;
                if (!card) return;

                const handleMouseMove = (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    
                    const rotateX = Math.max(-MAX_TILT_ANGLE, Math.min(MAX_TILT_ANGLE, (y - centerY) / MOUSE_TILT_SENSITIVITY));
                    const rotateY = Math.max(-MAX_TILT_ANGLE, Math.min(MAX_TILT_ANGLE, (centerX - x) / MOUSE_TILT_SENSITIVITY));
                    
                    setTiltStyle({
                        transform: `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`,
                        transition: 'transform 0.1s ease-out'
                    });
                };

                const handleMouseLeave = () => {
                    setTiltStyle({
                        transform: 'perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)',
                        transition: 'transform 0.5s ease-out'
                    });
                };

                card.addEventListener('mousemove', handleMouseMove);
                card.addEventListener('mouseleave', handleMouseLeave);

                // Handle device orientation for mobile tilt
                const handleOrientation = (e) => {
                    if (e.beta && e.gamma) {
                        const rotateX = Math.max(-MAX_TILT_ANGLE, Math.min(MAX_TILT_ANGLE, e.beta / ORIENTATION_TILT_SENSITIVITY));
                        const rotateY = Math.max(-MAX_TILT_ANGLE, Math.min(MAX_TILT_ANGLE, e.gamma / ORIENTATION_TILT_SENSITIVITY));
                        setTiltStyle({
                            transform: `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`,
                            transition: 'transform 0.1s ease-out'
                        });
                    }
                };

                window.addEventListener('deviceorientation', handleOrientation);

                return () => {
                    card.removeEventListener('mousemove', handleMouseMove);
                    card.removeEventListener('mouseleave', handleMouseLeave);
                    window.removeEventListener('deviceorientation', handleOrientation);
                };
            }, []);

            const handleImageSelect = async (preview, file) => {
                setImagePreview(preview);
                setImageFile(file);
                
                // Trigger AI analysis
                setAiStatus('analyzing');
                try {
                    const result = await analyzeImageWithAI(file);
                    setAiResult(result);
                    setAiStatus('verified');
                } catch (error) {
                    console.error('AI analysis failed:', error);
                    setAiStatus('pending');
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                const reportData = {
                    image: imageFile,
                    location: {
                        latitude: location.latitude,
                        longitude: location.longitude
                    },
                    description: description,
                    aiAnalysis: aiResult,
                    timestamp: new Date().toISOString()
                };
                
                console.log('Report submitted:', reportData);
                
                // Build success message
                let successMessage = '‚úÖ Report Submitted Successfully!\n\n';
                if (aiResult) {
                    successMessage += `AI Detection: ${aiResult.type}\n`;
                    successMessage += `Confidence: ${(aiResult.confidence * 100).toFixed(0)}%\n`;
                    successMessage += `Severity: ${aiResult.severity}`;
                } else {
                    successMessage += 'Pending AI verification';
                }
                
                alert(successMessage);
            };

            return (
                <>
                    <Header />
                    
                    <div 
                        ref={cardRef}
                        className="main-card glass-card tilt-container"
                        style={tiltStyle}
                    >
                        <h2 className="card-title">Report Road Damage</h2>
                        
                        <form onSubmit={handleSubmit}>
                            <UploadCard 
                                onImageSelect={handleImageSelect}
                                previewUrl={imagePreview}
                            />
                            
                            <LocationStatus 
                                latitude={location.latitude}
                                longitude={location.longitude}
                                status={location.status}
                                error={location.error}
                            />
                            
                            <div className="form-group">
                                <label className="form-label">üìù Description (Optional)</label>
                                <textarea
                                    className="input-textarea"
                                    placeholder="Please describe the road damage in detail (e.g., pothole size, location details, safety concerns)..."
                                    value={description}
                                    onChange={(e) => setDescription(e.target.value)}
                                />
                            </div>
                            
                            <div className="form-group">
                                <span className={`ai-badge ${aiStatus}`}>
                                    {aiStatus === 'pending' && 'ü§ñ AI Verification: Pending'}
                                    {aiStatus === 'analyzing' && '‚ö° AI Analyzing...'}
                                    {aiStatus === 'verified' && `‚úì AI Verified: ${aiResult?.type} (${(aiResult?.confidence * 100).toFixed(0)}%)`}
                                </span>
                            </div>
                            
                            <button 
                                type="submit" 
                                className="submit-btn"
                                disabled={!imageFile || location.status !== 'success'}
                            >
                                Submit Report
                            </button>
                        </form>
                    </div>
                </>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
